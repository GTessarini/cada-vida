<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <title>Cada Vida</title> 
        <link rel="stylesheet" href="style/style.css">       
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="canvas-container">
            <canvas id="my-canvas" width="5000" height="15000">
                Your browser does not support the canvas element.
            </canvas>
        </div>
        <div id="info-container">
            <h1 style="text-align: center;">Cada Vida</h1>
            <h2>Este gráfico representa em forma de pontos, individualmente, cada uma das vidas perdidas para a Covid-19 no Brasil</h2>
            <h3>Em respeito à cada uma dessas vidas</h3>
            <p>
                <b>
                    <sup>*</sup>Dados obtidos por meio do <a href="https://covid.saude.gov.br/" target="_blank" rel="noopener">Painel de casos de doença pelo coronavírus 2019 (COVID-19) no Brasil pelo Ministério da Saúde</a>
                </b>
            </p>
        </div>        
        <script>
            const canvasContainer = document.getElementById("canvas-container");
            const canvas = document.getElementById("my-canvas");
            const btnAtualizar = document.getElementById("btn-atualizar");
            const ctx = canvas.getContext("2d");
            let coordX = 0;
            let coordY = canvas.height;

            const setPixel = (ctx, coordX, coordY, color) => {
                ctx.beginPath();
                ctx.fillStyle = color;
                ctx.arc(coordX, coordY, 3, 3, Math.PI, true);
                ctx.closePath();
                ctx.fill();
            }

            const clearCanvas = (ctx, canvas) => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            const drawGraphic = (dias, coordX, coordY) => {
                let obitosPorDia = null;
                ctx.font = "15px Arial";
                ctx.fillStyle = "black";
                ctx.fillText(dias[0]["_id"], coordX, coordY);
                for(dia of dias){
                    coordX += 9;
                    coordY = canvas.height;     
                    obitosPorDia = dia["obitosNovos"];
                    console.log(dia["_id"] + ": " + obitosPorDia);
                    for(let obito = 0; obito < obitosPorDia; obito++){
                        coordY -= 9;
                        setPixel(ctx, coordX, coordY, ('#' + Math.random().toString(16).substr(2,6)));
                    }
                }
                ctx.fillStyle = "black";
                ctx.fillText(dias[dias.length - 1]["_id"], (coordX + 10), canvas.height);
                canvasContainer.scrollTo(0, canvas.height);
            }

            let dadosCovid = null;
            const url = "https://xx9p7hp1p7.execute-api.us-east-1.amazonaws.com/prod/PortalCasos";
            const getData = () => {
                $.ajax({
                    url : url,
                    type : "get",
                    beforeSend: () => {
                        clearCanvas(ctx, canvas);
                    }
                })
                .done((data) => {
                    dadosCovid = data;
                    drawGraphic(dadosCovid["dias"], coordX, coordY); 
                })
                .fail((jqXHR, textStatus, msg) => {
                    console.log(msg);
                });
            }
            $(document).ready(function(){
                getData();               
            });            

           /* Gabriel Tessarini */
        </script> 
    </body>
</html>